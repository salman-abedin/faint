#!/bin/sh
#
# Helper script for faint. Allows misc operations on files
#
# Dependencies: fzf, faint-config & faint-fetch-config

. faint-config

FILE_LIST_PATH=/tmp/FAINT_FILE_LIST
FILE_ARGS_PATH=/tmp/FAINT_FILE_ARGS

export FZF_DEFAULT_OPTS="\
   $FZF_DEFAULT_OPTS
   +m
   --bind \"$KEY_LAUNCH:accept\"
   "

read -r LAST_DIR < "$LAST_PATH"

FILE_ARGS=$(
   for file in "$@"; do
      echo "$LAST_DIR/${file#* }"
   done
)

: > "$FILE_ARGS_PATH"
for file in "$@"; do
   echo "$LAST_DIR/${file#* }" >> "$FILE_ARGS_PATH"
done

[ -f "$FILE_LIST_PATH" ] &&
   FILE_LIST=$(
      while read -r file; do
         echo "$file"
      done < "$FILE_LIST_PATH"
   )

CHOICE=$(faint-fetch-config "$OPS" -k | fzf) &&
   CMD=$(faint-fetch-config "$OPS" -v "${CHOICE#* }") &&
   $CMD 2> /dev/null
